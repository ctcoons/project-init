{% extends "core/base.html" %}
{% block content %}
<h1>{{ project.project_name }}</h1>
<p>{{ project.description }}</p>
<p>Groups: {{ project.group_names }}</p>

<!-- Add Subject Data button (only if owner) -->
{% if request.user == project.owner %}
    <a href="{% url 'add_subject_data' project.id %}" class="btn btn-primary mb-3">
        + Add Subject Data
    </a>
{% else %}
    <button class="btn btn-secondary mb-3" disabled title="Only the project owner can add subject data">
        + Add Subject Data
    </button>
{% endif %}

<h2>Data:</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Group</th>
            <th>Category</th>
            <th>Label</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        {% for group in group_data %}
        <tr data-bs-toggle="collapse" data-bs-target="#group-{{ group.id }}" style="cursor: pointer;">
            <td colspan="4"><strong>{{ group.group_name }}</strong>
                {% if group.group_sub_data.count %} (click to expand) {% endif %}
            </td>
        </tr>
        <tr class="collapse" id="group-{{ group.id }}">
            <td colspan="4" class="p-0">
                {% if group.group_sub_data.all %}
                <table class="table mb-0">
                    {% for sub in group.group_sub_data.all %}
                    <tr>
                        <td></td>
                        <td>{{ sub.category }}</td>
                        <td>{{ sub.label }}</td>
                        <td>{{ sub.value }}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}
                <div class="text-muted p-2">No sub-data</div>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Bootstrap collapse requires JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
